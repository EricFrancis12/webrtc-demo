<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <button id="create-room-btn">
        Create Room
    </button>

    <input id="room-id-input" />
    <button id="join-room-btn">
        Join Room
    </button>

    <script>
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const client_id = new URLSearchParams(window.location.search).get("client_id") ?? "";
        const ws = new WebSocket(`${protocol}//localhost:3000/ws?client_id=${client_id}`);

        ws.onopen = () => {
            console.log("Connected to ws server");
        };

        ws.onmessage = (e) => {
            console.log("Server response:", e.data);
        };

        ws.onerror = (err) => console.error("WebSocket error:", err);
        ws.onclose = () => console.log("Disconnected from ws server");

        const createRoomBtn = document.getElementById("create-room-btn");
        const roomIdInput = document.getElementById("room-id-input");
        const joinRoomBtn = document.getElementById("join-room-btn");

        createRoomBtn.addEventListener("click", () => {
            ws.send(JSON.stringify({ type: "CreateRoom" }));
        });

        joinRoomBtn.addEventListener("click", () => {
            try {
                const room_id = Number.parseInt(roomIdInput.value);
                ws.send(JSON.stringify({ type: "JoinRoom", room_id }));
            } catch (_) {
                console.error("Room ids must be numbers");
            }
        });
    </script>

</body>

</html>
